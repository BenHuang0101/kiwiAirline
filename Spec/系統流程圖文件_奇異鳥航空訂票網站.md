# 奇異鳥航空訂票網站 - 系統流程圖文件

## 文件資訊

- **文件名稱：** 奇異鳥航空訂票網站 系統流程圖文件
- **版本：** v1.0
- **撰寫人：** SA
- **日期：** 2025-07-17
- **文件狀態：** Draft

---

## 1. 用戶註冊流程圖

```mermaid
flowchart TD
    A[用戶進入註冊頁面] --> B[填寫註冊表單]
    B --> C{驗證輸入格式}
    C -->|格式錯誤| D[顯示錯誤提示]
    D --> B
    C -->|格式正確| E{檢查Email是否已存在}
    E -->|已存在| F[顯示Email已註冊錯誤]
    F --> B
    E -->|不存在| G[密碼加密處理]
    G --> H[儲存用戶資料到資料庫]
    H --> I[顯示註冊成功訊息]
    I --> J[跳轉至登入頁面]

    style A fill:#e1f5fe
    style J fill:#c8e6c9
    style F fill:#ffcdd2
    style D fill:#ffcdd2
```

**流程說明：**

1. 用戶填寫基本資料（姓名、Email、密碼、手機）
2. 前端驗證輸入格式（Email 格式、密碼強度）
3. 後端檢查 Email 唯一性
4. 密碼使用 bcrypt 加密儲存
5. 註冊成功後直接可使用帳戶登入

---

![](Flowchart/用戶註冊.png)

## 2. 用戶登入流程圖

```mermaid
flowchart TD
    A[用戶進入登入頁面] --> B[輸入Email和密碼]
    B --> C{驗證帳戶資訊}
    C -->|帳戶不存在或密碼錯誤| D[顯示登入失敗錯誤]
    C -->|驗證成功| E[生成JWT Token]
    E --> F[更新最後登入時間]
    F --> G[返回用戶資訊和Token]
    G --> H[跳轉至首頁或原請求頁面]

    D --> B

    style A fill:#
    style H fill:#c8e6c9
    style D fill:#ffcdd2
```

![](Flowchart/用戶登入.png)

**安全機制：**

- JWT Token 有效期 1 小時
- 記錄登入 IP 和時間
- 統一錯誤訊息防止帳戶探測

---

## 3. 航班搜尋流程圖

```mermaid
flowchart TD
    A[用戶進入首頁] --> B[填寫搜尋條件]
    B --> C[選擇出發地]
    C --> D[選擇目的地]
    D --> E[選擇出發日期]
    E --> F[選擇乘客人數]
    F --> G[點擊搜尋按鈕]
    G --> H{驗證搜尋參數}
    H -->|參數錯誤| I[顯示參數錯誤提示]
    I --> B
    H -->|參數正確| J[查詢資料庫航班資料]
    J --> K{是否有可用航班}
    K -->|無航班| L[顯示無結果頁面]
    L --> M[建議修改搜尋條件]
    M --> B
    K -->|有航班| N[計算可用座位數]
    N --> O[應用排序條件]
    O --> P[顯示航班搜尋結果]
    P --> Q[用戶可進一步篩選排序]
    Q --> R[選擇特定航班查看詳情]

    style A fill:#e1f5fe
    style P fill:#c8e6c9
    style I fill:#ffcdd2
    style L fill:#fff3e0
```

![](Flowchart/航班搜尋.png)

**搜尋優化：**

- 快取熱門路線搜尋結果 15 分鐘
- 支援模糊搜尋機場名稱
- 自動建議替代日期和機場

---

## 4. 完整訂票流程圖

```mermaid
flowchart TD
    A[用戶選擇航班] --> B[點擊預訂按鈕]
    B --> C{檢查用戶登入狀態}
    C -->|未登入| D[跳轉至登入頁面]
    D --> E[登入後返回訂票流程]
    C -->|已登入| E
    E --> F[進入乘客資訊填寫頁面]
    F --> G[填寫乘客基本資料]
    G --> H[姓名、護照號碼、出生日期]
    H --> I[聯絡人資訊]
    I --> J{驗證乘客資訊格式}
    J -->|格式錯誤| K[顯示錯誤提示]
    K --> G
    J -->|格式正確| L[顯示訂單摘要]
    L --> M[確認航班和乘客資訊]
    M --> N[進入付款頁面]
    N --> O[選擇付款方式]
    O --> P[填寫付款資訊]
    P --> Q{處理付款}
    Q -->|付款失敗| R[顯示付款錯誤]
    R --> N
    Q -->|付款成功| S[建立訂單記錄]
    S --> T[分配座位]
    T --> U[生成電子機票]
    U --> V[發送確認郵件]
    V --> W[顯示訂票成功頁面]
    W --> X[跳轉至訂單詳情]

    style A fill:#e1f5fe
    style X fill:#c8e6c9
    style K fill:#ffcdd2
    style R fill:#ffcdd2
```

![](Flowchart/訂票流程.png)

**重要檢查點：**

1. **航班可用性：** 確認選購時航班仍有座位
2. **資料驗證：** 護照格式、日期有效性
3. **付款安全：** PCI DSS 規範，信用卡資訊加密
4. **庫存控制：** 防止超賣機制

---

## 5. 訂單管理流程圖

### 5.1 查看訂單流程

```mermaid
flowchart TD
    A[用戶登入會員中心] --> B[點擊我的訂單]
    B --> C[載入用戶訂單列表]
    C --> D{是否有訂單記錄}
    D -->|無訂單| E[顯示空狀態頁面]
    E --> F[提供航班搜尋連結]
    D -->|有訂單| G[顯示訂單列表]
    G --> H[按狀態和日期排序]
    H --> I[用戶可篩選訂單狀態]
    I --> J[點擊特定訂單]
    J --> K[顯示訂單詳細資訊]
    K --> L[顯示航班詳情]
    L --> M[顯示乘客資訊]
    M --> N[顯示付款記錄]
    N --> O[提供操作選項]
    O --> P[修改/取消/下載機票]

    style A fill:#e1f5fe
    style K fill:#c8e6c9
    style E fill:#fff3e0
```

![](Flowchart/查看訂單.png)

### 5.2 修改訂單流程

```mermaid
flowchart TD
    A[用戶選擇修改訂單] --> B{檢查訂單狀態}
    B -->|無法修改| C[顯示修改限制訊息]
    B -->|可以修改| D[顯示可修改選項]
    D --> E[修改日期/修改乘客資訊]
    E --> F{選擇修改類型}
    F -->|修改日期| G[搜尋替代航班]
    F -->|修改乘客| H[編輯乘客資訊]
    G --> I[顯示可用替代航班]
    I --> J[計算價差和手續費]
    J --> K[用戶確認修改]
    H --> K
    K --> M{處理額外付款}
    M -->|需要付款| N[進入付款流程]
    M -->|無需付款| O[直接更新訂單]
    N --> P{付款是否成功}
    P -->|失敗| Q[取消修改操作]
    P -->|成功| O
    O --> R[更新訂單資料]
    R --> S[重新分配座位(如需要)]
    S --> T[顯示修改成功頁面]

    style A fill:#e1f5fe
    style T fill:#c8e6c9
    style C fill:#ffcdd2
    style Q fill:#ffcdd2
```

![](Flowchart/修改訂單.png)

### 5.3 取消訂單流程

```mermaid
flowchart TD
    A[用戶選擇取消訂單] --> B{檢查取消政策}
    B -->|超過取消期限| C[顯示無法取消訊息]
    B -->|可以取消| D[顯示取消政策說明]
    D --> E[計算退款金額]
    E --> F[顯示手續費明細]
    F --> G[用戶確認取消]
    G --> H{用戶最終確認}
    H -->|取消操作| I[返回訂單頁面]
    H -->|確認取消| J[更新訂單狀態為已取消]
    J --> K[釋放航班座位]
    K --> L[處理退款作業]
    L --> M{退款處理}
    M -->|退款成功| N[顯示取消成功頁面]
    M -->|退款失敗| O[記錄問題並通知客服]
    O --> P[顯示退款處理中訊息]

    style A fill:#e1f5fe
    style N fill:#c8e6c9
    style C fill:#ffcdd2
    style O fill:#fff3e0
```

![](Flowchart/取消訂單.png)

## 6. 客服工單處理流程圖

```mermaid
flowchart TD
    A[用戶進入客服頁面] --> B[查看常見問題FAQ]
    B --> C{FAQ是否解決問題}
    C -->|問題已解決| D[用戶結束流程]
    C -->|未解決| E[填寫問題表單]
    E --> F[選擇問題分類]
    F --> G[填寫問題詳細描述]
    G --> H[提供聯絡資訊]
    H --> I[關聯相關訂單(可選)]
    I --> J[提交工單]
    J --> K[系統自動分配工單編號]
    K --> L[根據分類分配給客服人員]
    L --> M[發送工單建立確認郵件]
    M --> N[客服人員處理工單]
    N --> O{需要更多資訊}
    O -->|是| P[客服回覆請求更多資訊]
    O -->|否| Q[客服提供解決方案]
    P --> R[用戶補充資訊]
    R --> N
    Q --> S[更新工單狀態為已解決]
    S --> T[發送解決方案郵件]
    T --> U[用戶確認問題已解決]
    U --> V[關閉工單]

    style A fill:#e1f5fe
    style D fill:#c8e6c9
    style V fill:#c8e6c9
```

![](Flowchart/客服工單處理.png)

**工單優先級規則：**

- **緊急：** 影響行程的問題（起飛前 24 小時）
- **高：** 付款問題、系統錯誤
- **中：** 一般查詢、訂單修改
- **低：** 建議反映、非緊急問題

---

## 7. 付款處理流程圖

```mermaid
flowchart TD
    A[用戶進入付款頁面] --> B[選擇付款方式]
    B --> C{付款方式}
    C -->|信用卡| D[填寫信用卡資訊]
    C -->|ATM轉帳| E[顯示轉帳資訊]
    C -->|銀行轉帳| F[顯示銀行帳戶]

    D --> G[前端驗證卡號格式]
    G --> H{格式驗證}
    H -->|錯誤| I[顯示格式錯誤]
    I --> D
    H -->|正確| J[加密敏感資訊]
    J --> K[呼叫第三方金流API]

    E --> L[生成轉帳代碼]
    F --> M[提供銀行帳戶資訊]

    K --> N{金流處理結果}
    N -->|成功| O[更新付款狀態為完成]
    N -->|失敗| P[記錄失敗原因]
    P --> Q[顯示付款失敗訊息]
    Q --> B

    L --> R[等待銀行回傳結果]
    M --> S[等待人工確認]
    R --> T{收到付款確認}
    S --> U{人工確認付款}
    T -->|確認收款| O
    T -->|超時未付| V[訂單狀態設為待付款]
    U -->|確認| O
    U -->|拒絕| W[聯絡用戶確認]

    O --> X[建立付款記錄]
    X --> Y[確認訂單狀態]
    Y --> Z[發送付款成功通知]
    Z --> AA[完成付款流程]

    style A fill:#e1f5fe
    style AA fill:#c8e6c9
    style I fill:#ffcdd2
    style Q fill:#ffcdd2
    style V fill:#fff3e0
    style W fill:#fff3e0
```

![](Flowchart/付款處理.png)

**安全措施：**

- 信用卡號碼前端遮罩顯示
- 敏感資料 SSL/TLS 加密傳輸
- 符合 PCI DSS 安全標準
- 付款超時機制（15 分鐘）

---

## 8. 系統錯誤處理流程圖

```mermaid
flowchart TD
    A[系統發生錯誤] --> B{錯誤類型判斷}
    B -->|網路錯誤| C[顯示網路連線錯誤]
    B -->|伺服器錯誤| D[顯示系統暫時無法服務]
    B -->|資料驗證錯誤| E[顯示具體錯誤欄位]
    B -->|權限錯誤| F[跳轉至登入頁面]
    B -->|業務邏輯錯誤| G[顯示業務規則說明]

    C --> H[提供重試選項]
    D --> I[記錄錯誤日誌]
    E --> J[標示錯誤欄位]
    F --> K[保存用戶當前操作]
    G --> L[提供替代方案]

    I --> M[自動通知技術團隊]
    M --> N[技術團隊處理]
    N --> O[系統恢復正常]

    H --> P{用戶選擇重試}
    P -->|是| Q[重新執行操作]
    P -->|否| R[用戶離開或求助]

    J --> S[用戶修正輸入]
    K --> T[登入後恢復操作]
    L --> U[用戶選擇替代方案]

    style A fill:#ffcdd2
    style O fill:#c8e6c9
    style T fill:#c8e6c9
    style U fill:#c8e6c9
```

![](Flowchart/系統錯誤流程處理.png)

**錯誤監控機制：**

- 即時錯誤日誌記錄
- 自動告警系統
- 錯誤率監控 dashboard
- 用戶體驗追蹤

---

## 9. 資料同步流程圖

```mermaid
flowchart TD
    A[航班資料更新觸發] --> B[接收航班API資料]
    B --> C[驗證資料格式]
    C --> D{資料驗證結果}
    D -->|驗證失敗| E[記錄錯誤並告警]
    D -->|驗證成功| F[比對現有資料]
    F --> G{資料是否有變更}
    G -->|無變更| H[結束同步流程]
    G -->|有變更| I[更新航班資料]
    I --> J[檢查影響的訂單]
    J --> K{是否有影響訂單}
    K -->|無影響| L[完成同步]
    K -->|有影響| M[通知受影響用戶]
    M --> N[發送航班變更通知郵件]
    N --> O[更新訂單狀態]
    O --> P[記錄變更日誌]
    P --> L

    E --> Q[技術團隊處理]
    Q --> R[修正資料來源]
    R --> A

    style A fill:#e1f5fe
    style L fill:#c8e6c9
    style E fill:#ffcdd2
    style M fill:#fff3e0
```

![](Flowchart/資料同步流程.png)

**同步策略：**

- 每小時自動同步航班狀態
- 即時接收重要變更（取消、延誤）
- 資料衝突自動解決機制
- 保留歷史變更記錄

---

✏️ _最後更新時間：2025-07-17_
